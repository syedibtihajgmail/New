<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP & DNS Lookup Tool</title>
    <style>
        /* General Styling */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #eef2f7;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            color: #333;
        }

        /* Navigation Bar Styling */
        nav {
            width: 100%;
            background-color: #2c3e50;
            padding: 10px 0;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Allows buttons to wrap to the next line on small screens */
        }

        nav button {
            background-color: #34495e;
            color: white;
            border: none;
            padding: 12px 22px;
            margin: 5px; /* Added margin for better spacing on mobile */
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            white-space: nowrap;
        }

        nav button:hover {
            background-color: #1abc9c;
            transform: translateY(-2px);
        }

        nav button.active {
            background-color: #1abc9c;
            box-shadow: 0 0 15px rgba(26, 188, 156, 0.7);
            transform: scale(1.05);
        }

        /* Content Container Styling */
        .content-section {
            display: none;
            width: 100%;
            max-width: 700px;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            width: 100%;
            text-align: center;
        }

        h1, h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-direction: row; /* Default for desktop */
            flex-wrap: nowrap;
        }
        
        .input-group input {
            flex-grow: 1;
            padding: 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
        }

        .input-group button, .input-group-button {
            padding: 12px 25px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        .input-group button:hover, .input-group-button:hover {
            background-color: #2980b9;
        }

        #findMyIpLink {
            display: block;
            margin-bottom: 20px;
            color: #3498db;
            text-decoration: none;
            cursor: pointer;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        #findMyIpLink:hover {
            color: #2980b9;
            text-decoration: underline;
        }

        .results {
            text-align: left;
            margin-top: 25px;
            border-top: 2px solid #ecf0f1;
            padding-top: 20px;
            display: none;
        }

        .results p {
            margin: 10px 0;
            line-height: 1.6;
            color: #555;
        }
        
        .results p strong {
            color: #2c3e50;
        }

        /* Tables */
        .results table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            table-layout: fixed;
        }

        .results th, .results td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            word-wrap: break-word;
        }

        .results th {
            background-color: #f4f6f8;
            font-weight: bold;
            color: #555;
        }

        /* Loading Spinner */
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none; /* Hidden by default */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Error Message */
        .error-message {
            color: #e74c3c;
            text-align: center;
            margin-top: 15px;
            display: none;
            font-weight: bold;
        }
        
        /* Security Check Statuses */
        .security-status {
            font-weight: bold;
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            font-size: 1.1em;
        }

        .security-status.safe {
            background-color: #d4edda;
            color: #155724;
        }

        .security-status.warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        /* Security Sub-sections */
        .security-sub-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
        }

        .introduction {
            width: 100%;
            max-width: 700px;
            background-color: #ffffff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* Mobile-first styling */
        @media (max-width: 768px) {
            nav {
                flex-direction: column;
                padding: 10px;
                align-items: center;
            }

            nav button {
                width: 95%;
                margin: 5px 0;
            }

            .input-group {
                flex-direction: column;
            }

            .input-group button, .input-group-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

    <nav>
        <button id="showIpLookup" class="active">IP Lookup</button>
        <button id="showDnsLookup">DNS Lookup</button>
        <button id="showMxLookup">MX Lookup</button>
        <button id="showDmarcLookup">DMARC</button>
        <button id="showSpfLookup">SPF</button>
        <button id="showDkimLookup">DKIM</button>
        <button id="showCnameLookup">CNAME</button>
        <button id="showAaaaLookup">AAAA</button>
        <button id="showIpLeakTest">IP Leak Test</button>
        <button id="showDomainInfo">Domain Info</button>
        <button id="showSecurityChecks">Security Checks</button>
        <button id="showKnowYourLookup">Know Your Lookup</button>
    </nav>

    <div class="introduction">
        <p>Welcome to the free IP & DNS Lookup Tool. This page provides a comprehensive set of network diagnostic tools, allowing you to perform IP address geolocation, look up various DNS records, and run security checks on both IP addresses and domains.</p>
    </div>

    <div id="ipLookupSection" class="content-section" style="display: block;">
        <div class="container">
            <h1>IP Address Geolocation</h1>
            <form id="ipForm">
                <div class="input-group">
                    <input type="text" id="ipInput" placeholder="Enter an IP (e.g., 8.8.8.8)">
                    <button type="submit" id="lookupIpButton">Lookup IP</button>
                </div>
                <a href="#" id="findMyIpLink">Find My IP</a>
            </form>
            
            <p id="error-message-ip" class="error-message"></p>
            <div id="ipLoadingSpinner" class="loading-spinner"></div>

            <div id="ipResults" class="results">
                <h2>Geolocation Details</h2>
                <p><strong>IP Address:</strong> <span id="ip-address"></span></p>
                <p><strong>Country:</strong> <span id="country"></span></p>
                <p><strong>City:</strong> <span id="city"></span></p>
                <p><strong>Region:</strong> <span id="region"></span></p>
                <p><strong>ISP:</strong> <span id="isp"></span></p>
                <p><strong>Registrar:</strong> <span id="registrar"></span></p>
                <p><strong>Timezone:</strong> <span id="timezone"></span></p>
            </div>
        </div>
    </div>
    
    <div id="dnsLookupSection" class="content-section">
        <div class="container">
            <h1>DNS Record Lookup</h1>
            <form id="dnsForm">
                <div class="input-group">
                    <input type="text" id="dnsInput" placeholder="Enter a domain (e.g., google.com)">
                    <button type="submit" id="lookupDnsButton">Lookup DNS</button>
                </div>
            </form>
            
            <p id="error-message-dns" class="error-message"></p>
            <div id="dnsLoadingSpinner" class="loading-spinner"></div>

            <div id="dnsResults" class="results">
                <h2>DNS Records</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Record</th>
                            <th>TTL</th>
                        </tr>
                    </thead>
                    <tbody id="dnsTableBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="mxLookupSection" class="content-section">
        <div class="container">
            <h1>MX Record Lookup</h1>
            <form id="mxForm">
                <div class="input-group">
                    <input type="text" id="mxDomainInput" placeholder="Enter a domain (e.g., example.com)">
                    <button type="submit" id="lookupMxButton">Lookup MX</button>
                </div>
            </form>
            
            <p id="error-message-mx" class="error-message"></p>
            <div id="mxLoadingSpinner" class="loading-spinner"></div>

            <div id="mxResults" class="results">
                <h2>MX Records</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Pref</th>
                            <th>Hostname</th>
                            <th>IP Addresses</th>
                            <th>TTL</th>
                        </tr>
                    </thead>
                    <tbody id="mxTableBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="dmarcLookupSection" class="content-section">
        <div class="container">
            <h1>DMARC Record Lookup</h1>
            <form id="dmarcForm">
                <div class="input-group">
                    <input type="text" id="dmarcDomainInput" placeholder="Enter a domain (e.g., google.com)">
                    <button type="submit" id="lookupDmarcButton">Lookup DMARC</button>
                </div>
            </form>
            
            <p id="error-message-dmarc" class="error-message"></p>
            <div id="dmarcLoadingSpinner" class="loading-spinner"></div>

            <div id="dmarcResults" class="results">
                <h2>DMARC Record</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Record</th>
                            <th>TTL</th>
                        </tr>
                    </thead>
                    <tbody id="dmarcTableBody">
                        </tbody>
                </table>
                <p style="font-size: 0.9em; color: #888; margin-top: 15px;">
                    DMARC records are TXT records starting with "v=DMARC1".
                </p>
            </div>
        </div>
    </div>

    <div id="spfLookupSection" class="content-section">
        <div class="container">
            <h1>SPF Record Lookup</h1>
            <form id="spfForm">
                <div class="input-group">
                    <input type="text" id="spfDomainInput" placeholder="Enter a domain (e.g., google.com)">
                    <button type="submit" id="lookupSpfButton">Lookup SPF</button>
                </div>
            </form>
            
            <p id="error-message-spf" class="error-message"></p>
            <div id="spfLoadingSpinner" class="loading-spinner"></div>

            <div id="spfResults" class="results">
                <h2>SPF Records</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Record</th>
                            <th>TTL</th>
                        </tr>
                    </thead>
                    <tbody id="spfTableBody">
                        </tbody>
                </table>
                <p style="font-size: 0.9em; color: #888; margin-top: 15px;">
                    SPF records are TXT records starting with "v=spf1".
                </p>
            </div>
        </div>
    </div>

    <div id="dkimLookupSection" class="content-section">
        <div class="container">
            <h1>DKIM Record Lookup</h1>
            <form id="dkimForm">
                <div class="input-group">
                    <input type="text" id="dkimDomainInput" placeholder="Enter domain (e.g., google.com)">
                    <button type="submit" id="lookupDkimButton">Lookup DKIM</button>
                </div>
            </form>
            
            <p id="error-message-dkim" class="error-message"></p>
            <div id="dkimLoadingSpinner" class="loading-spinner"></div>

            <div id="dkimResults" class="results">
                <h2>DKIM Records</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Record</th>
                            <th>TTL</th>
                        </tr>
                    </thead>
                    <tbody id="dkimTableBody">
                        </tbody>
                </table>
                <p style="font-size: 0.9em; color: #888; margin-top: 15px;">
                    DKIM records are TXT records found at `selector._domainkey.yourdomain.com`. This tool attempts common selectors.
                </p>
            </div>
        </div>
    </div>

    <div id="cnameLookupSection" class="content-section">
        <div class="container">
            <h1>CNAME Record Lookup</h1>
            <form id="cnameForm">
                <div class="input-group">
                    <input type="text" id="cnameDomainInput" placeholder="Enter a domain or subdomain (e.g., www.example.com)">
                    <button type="submit" id="lookupCnameButton">Lookup CNAME</button>
                </div>
            </form>
            
            <p id="error-message-cname" class="error-message"></p>
            <div id="cnameLoadingSpinner" class="loading-spinner"></div>

            <div id="cnameResults" class="results">
                <h2>CNAME Records</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Record</th>
                            <th>TTL</th>
                        </tr>
                    </thead>
                    <tbody id="cnameTableBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="aaaaLookupSection" class="content-section">
        <div class="container">
            <h1>AAAA Record Lookup</h1>
            <p style="font-size: 0.9em; color: #6c757d; margin-bottom: 20px;">IPv6 address only</p>
            <form id="aaaaForm">
                <div class="input-group">
                    <input type="text" id="aaaaDomainInput" placeholder="Enter a domain (e.g., google.com)">
                    <button type="submit" id="lookupAaaaButton">Lookup AAAA</button>
                </div>
            </form>
            
            <p id="error-message-aaaa" class="error-message"></p>
            <div id="aaaaLoadingSpinner" class="loading-spinner"></div>

            <div id="aaaaResults" class="results">
                <h2>AAAA Records</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Record</th>
                            <th>TTL</th>
                        </tr>
                    </thead>
                    <tbody id="aaaaTableBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="ipLeakTestSection" class="content-section">
        <div class="container">
            <h1>IP Leak Test</h1>
            <p style="font-size: 0.9em; color: #6c757d; margin-bottom: 20px;">
                This test reveals your current public IP address to check for potential leaks.
            </p>
            <button id="performIpLeakTestButton" class="input-group-button">Perform Leak Test</button>
            
            <p id="error-message-ip-leak" class="error-message"></p>
            <div id="ipLeakTestLoadingSpinner" class="loading-spinner"></div>

            <div id="ipLeakTestResults" class="results">
                <h2>Your Public IP Information</h2>
                <p><strong>Detected IP Address:</strong> <span id="leak-ip-address"></span></p>
                <p><strong>Hostname:</strong> <span id="leak-hostname"></span></p>
                <p><strong>Country:</strong> <span id="leak-country"></span></p>
                <p><strong>City:</strong> <span id="leak-city"></span></p>
                <p><strong>ISP:</strong> <span id="leak-isp"></span></p>
            </div>
        </div>
    </div>

    <div id="domainInfoSection" class="content-section">
        <div class="container">
            <h1>Domain Registration Information</h1>
            <form id="domainInfoForm">
                <div class="input-group">
                    <input type="text" id="domainInfoInput" placeholder="Enter a domain (e.g., google.com)">
                    <button type="submit" id="lookupDomainInfoButton">Lookup Info</button>
                </div>
            </form>
            
            <p id="error-message-domain-info" class="error-message"></p>
            <div id="domainInfoLoadingSpinner" class="loading-spinner"></div>

            <div id="domainInfoResults" class="results">
                <h2>WHOIS Details</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="domainInfoTableBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="securityChecksSection" class="content-section">
        <div class="container">
            <h1>Security Checks</h1>

            <div class="security-sub-section">
                <h2>IP Security Check</h2>
                <form id="ipSecurityForm">
                    <div class="input-group">
                        <input type="text" id="securityIpInput" placeholder="Enter an IP (e.g., 1.1.1.1)">
                        <button type="submit" id="checkIpSecurityButton">Check IP Security</button>
                    </div>
                </form>
                
                <p id="error-message-security-ip" class="error-message"></p>
                <div id="ipSecurityLoadingSpinner" class="loading-spinner"></div>

                <div id="ipSecurityResults" class="results">
                    <h3>IP Status</h3>
                    <p id="securityIpAddress"><strong>IP Address:</strong> <span></span></p>
                    <div id="securityStatusMessage" class="security-status"></div>
                    <p><strong>VPN Detected:</strong> <span id="vpnStatus"></span></p>
                    <p><strong>Proxy Detected:</strong> <span id="proxyStatus"></span></p>
                    <p><strong>TOR Detected:</strong> <span id="torStatus"></span></p>
                </div>
            </div>

            <div class="security-sub-section">
                <h2>Domain Security Check</h2>
                <form id="domainSecurityForm">
                    <div class="input-group">
                        <input type="text" id="securityDomainInput" placeholder="Enter a domain (e.g., badsite.com)">
                        <button type="submit" id="checkDomainSecurityButton">Check Domain Security</button>
                    </div>
                </form>
                
                <p id="error-message-security-domain" class="error-message"></p>
                <div id="domainSecurityLoadingSpinner" class="loading-spinner"></div>

                <div id="domainSecurityResults" class="results">
                    <h3>Domain Status</h3>
                    <p><strong>Domain:</strong> <span id="checkedDomain"></span></p>
                    <div id="domainSecurityStatusMessage" class="security-status"></div>
                    <table>
                        <thead>
                            <tr>
                                <th>Check</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="domainSecurityTableBody">
                            </tbody>
                    </table>
                    <p style="font-size: 0.9em; color: #888; margin-top: 15px;">
                        Note: This check verifies domain resolvability and common record presence, not a comprehensive blacklist.
                        True blacklist checks often require API keys from specialized services.
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div id="knowYourLookupSection" class="content-section">
        <div class="container" style="text-align: left;">
            <h1>Know Your Lookup</h1>
            <p>This tool suite provides various ways to inspect and diagnose network information. Each section serves a unique purpose, from identifying where an IP address is located to checking a domain's email and security settings. Below is a brief explanation of each lookup type.</p>
            <br>
            <h3>IP Lookup</h3>
            <p><strong>IP Lookup</strong> is used to find the geographical location (geolocation) and network information of an IP address. This can help you determine the country, city, and Internet Service Provider (ISP) associated with a specific IP.</p>
            <br>
            <h3>DNS Lookup</h3>
            <p><strong>DNS Lookup</strong> is a powerful tool for querying the Domain Name System (DNS). DNS records are like a phonebook for the internet, translating human-readable domain names (like <code>google.com</code>) into machine-readable IP addresses. This tool will display various records, including A, AAAA, and TXT records. (Under Construction)</p>
            <br>
            <h3>MX Lookup</h3>
            <p>An <strong>MX Lookup</strong> queries a domain for its Mail Exchanger (MX) records. These records tell the internet which mail servers are responsible for accepting email on behalf of a domain. It is an essential step for diagnosing email delivery issues.</p>
            <br>
            <h3>DMARC, SPF, and DKIM</h3>
            <p>These three lookups are crucial for email authentication and security. <strong>DMARC</strong> (Domain-based Message Authentication, Reporting, and Conformance), <strong>SPF</strong> (Sender Policy Framework), and <strong>DKIM</strong> (DomainKeys Identified Mail) records help prevent email spoofing and phishing by verifying that an email came from a legitimate source.</p>
            <br>
            <h3>CNAME and AAAA Lookup</h3>
            <p>A <strong>CNAME Lookup</strong> is used to find canonical name records, which are aliases for other domains. For example, <code>www.example.com</code> might be a CNAME record pointing to <code>example.com</code>. An <strong>AAAA Lookup</strong> specifically finds the IPv6 address (the modern version of an IP address) for a domain.</p>
            <br>
            <h3>IP Leak Test</h3>
            <p>An <strong>IP Leak Test</strong> checks if your connection is exposing your real IP address, especially when you are using a VPN or proxy. It is a simple but effective way to ensure your privacy tool is working correctly.</p>
            <br>
            <h3>Domain Info (WHOIS)</h3>
            <p>The <strong>Domain Info</strong> lookup uses the WHOIS protocol to retrieve registration information for a domain name. This can include the registrar, registration and expiration dates, and contact information for the domain owner (if not protected by privacy services).</p>
            <br>
            <h3>Security Checks</h3>
            <p>The <strong>Security Checks</strong> section provides a quick assessment of an IP address or domain. It checks an IP for associations with known VPNs, proxies, or TOR nodes, and it verifies a domain's basic record configuration to identify potential issues or signs of a non-functional site.</p>
        </div>
    </div>

    <script>
        // --- Helper functions for DOM manipulation and API calls ---
        
        /**
         * Shows or hides a loading spinner and clears previous results/errors.
         * @param {string} loadingSpinnerId - The ID of the loading spinner element.
         * @param {string} resultsDivId - The ID of the results container.
         * @param {string} errorMessageId - The ID of the error message container.
         * @param {boolean} show - True to show the spinner, false to hide it.
         */
        function toggleLoadingState(loadingSpinnerId, resultsDivId, errorMessageId, show) {
            document.getElementById(loadingSpinnerId).style.display = show ? 'block' : 'none';
            document.getElementById(resultsDivId).style.display = 'none';
            document.getElementById(errorMessageId).style.display = 'none';
        }

        /**
         * Displays an error message and logs the error to the console.
         * @param {string} errorMessageId - The ID of the error message container.
         * @param {string} message - The message to display.
         * @param {Error|string} [error] - The error object to log.
         */
        function displayError(errorMessageId, message, error) {
            const errorMessage = document.getElementById(errorMessageId);
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            console.error('Fetch error:', error);
        }

        /**
         * Fetches DNS records from Cloudflare DNS over HTTPS.
         * @param {string} name - The domain or subdomain to query.
         * @param {string} type - The DNS record type (e.g., 'A', 'MX').
         * @returns {Promise<object>} - The JSON response from the API.
         */
        async function fetchDnsRecords(name, type) {
            const apiURL = `https://cloudflare-dns.com/dns-query?name=${name}&type=${type}`;
            const response = await fetch(apiURL, {
                headers: { 'Accept': 'application/dns-json' }
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        }

        /**
         * Populates a table with DNS records.
         * @param {HTMLTableSectionElement} tableBody - The tbody element to populate.
         * @param {Array} records - An array of DNS record objects.
         */
        function populateDnsTable(tableBody, records) {
            records.forEach(record => {
                const row = tableBody.insertRow();
                const typeCell = row.insertCell(0);
                const recordCell = row.insertCell(1);
                const ttlCell = row.insertCell(2);
                
                // Map numerical type to string representation
                let recordTypeStr = '';
                switch(record.type) {
                    case 1: recordTypeStr = 'A'; break;
                    case 2: recordTypeStr = 'NS'; break; 
                    case 5: recordTypeStr = 'CNAME'; break; 
                    case 15: recordTypeStr = 'MX'; break;
                    case 16: recordTypeStr = 'TXT'; break;
                    case 28: recordTypeStr = 'AAAA'; break;
                    default: recordTypeStr = record.type; 
                }
                typeCell.textContent = recordTypeStr;
                
                // Remove trailing dot for some record types
                recordCell.textContent = (record.type === 2 || record.type === 5 || record.type === 15) 
                    ? record.data.replace(/\.$/, '') : record.data;
                
                ttlCell.textContent = record.TTL;
            });
        }
        
        // --- Lookup Functions ---

        async function performIpLookup(ipAddress) {
            toggleLoadingState('ipLoadingSpinner', 'ipResults', 'error-message-ip', true);
            const apiURL = ipAddress ? `https://ipinfo.io/${ipAddress}/json` : `https://ipinfo.io/json`;

            try {
                const response = await fetch(apiURL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();

                if (data.error) {
                    displayError('error-message-ip', data.error.message || 'Error looking up IP address.', data.error);
                } else {
                    document.getElementById('ip-address').textContent = data.ip || 'N/A';
                    document.getElementById('country').textContent = data.country || 'N/A';
                    document.getElementById('city').textContent = data.city || 'N/A';
                    document.getElementById('region').textContent = data.region || 'N/A';
                    document.getElementById('isp').textContent = data.org || 'N/A';
                    document.getElementById('registrar').textContent = data.org || 'N/A';
                    document.getElementById('timezone').textContent = data.timezone || 'N/A';
                    document.getElementById('ipResults').style.display = 'block';
                }
            } catch (error) {
                displayError('error-message-ip', 'An error occurred. Please check your connection or the IP address.', error);
            } finally {
                document.getElementById('ipLoadingSpinner').style.display = 'none';
            }
        }
        
        async function performDnsLookup(domain) {
            toggleLoadingState('dnsLoadingSpinner', 'dnsResults', 'error-message-dns', true);
            document.getElementById('dnsTableBody').innerHTML = '';

            if (!domain) {
                displayError('error-message-dns', 'Please enter a domain name.');
                document.getElementById('dnsLoadingSpinner').style.display = 'none';
                return;
            }

            const recordTypes = ['A', 'AAAA', 'TXT', 'NS', 'CNAME'];
            const fetchPromises = recordTypes.map(type => fetchDnsRecords(domain, type).catch(() => ({ Answer: [] })));

            try {
                const allData = await Promise.all(fetchPromises);
                let hasRecords = false;

                allData.forEach(data => {
                    if (data.Answer && data.Answer.length > 0) {
                        hasRecords = true;
                        populateDnsTable(document.getElementById('dnsTableBody'), data.Answer);
                    }
                });

                if (hasRecords) {
                    document.getElementById('dnsResults').style.display = 'block';
                } else {
                    displayError('error-message-dns', 'No DNS records found for this domain.');
                }
            } catch (error) {
                displayError('error-message-dns', 'An error occurred. Please check your connection or the domain name.', error);
            } finally {
                document.getElementById('dnsLoadingSpinner').style.display = 'none';
            }
        }

        async function performMxLookup(domain) {
            toggleLoadingState('mxLoadingSpinner', 'mxResults', 'error-message-mx', true);
            document.getElementById('mxTableBody').innerHTML = ''; 

            if (!domain) {
                displayError('error-message-mx', 'Please enter a domain name.');
                document.getElementById('mxLoadingSpinner').style.display = 'none';
                return;
            }

            try {
                const data = await fetchDnsRecords(domain, 'MX');
                if (data.Answer && data.Answer.length > 0) {
                    const ipLookupPromises = data.Answer.map(mxRecord => {
                        const parts = mxRecord.data.split(' ');
                        const preference = parts[0];
                        const hostname = parts[1].replace(/\.$/, '');
                        const mxTTL = mxRecord.TTL;
                        return Promise.all([
                            fetchDnsRecords(hostname, 'A').catch(() => ({ Answer: [] })),
                            fetchDnsRecords(hostname, 'AAAA').catch(() => ({ Answer: [] }))
                        ]).then(ipData => {
                            const ips = ipData.flatMap(res => res.Answer || []).map(record => record.data);
                            return { preference, hostname, ips: ips.join(', ') || 'N/A', ttl: mxTTL };
                        });
                    });

                    const mxRecordsWithIps = await Promise.all(ipLookupPromises);
                    mxRecordsWithIps.forEach(record => {
                        const row = document.getElementById('mxTableBody').insertRow();
                        row.insertCell(0).textContent = record.preference;
                        row.insertCell(1).textContent = record.hostname;
                        row.insertCell(2).textContent = record.ips;
                        row.insertCell(3).textContent = record.ttl;
                    });
                    document.getElementById('mxResults').style.display = 'block';
                } else {
                    displayError('error-message-mx', 'No MX records found for this domain.');
                }
            } catch (error) {
                displayError('error-message-mx', 'An error occurred. Please check your connection or the domain name.', error);
            } finally {
                document.getElementById('mxLoadingSpinner').style.display = 'none';
            }
        }

        async function performDmarcLookup(domain) {
            toggleLoadingState('dmarcLoadingSpinner', 'dmarcResults', 'error-message-dmarc', true);
            document.getElementById('dmarcTableBody').innerHTML = '';

            if (!domain) {
                displayError('error-message-dmarc', 'Please enter a domain name.');
                document.getElementById('dmarcLoadingSpinner').style.display = 'none';
                return;
            }

            const dmarcDomain = `_dmarc.${domain}`;
            try {
                const data = await fetchDnsRecords(dmarcDomain, 'TXT');
                const dmarcRecords = (data.Answer || []).filter(record => record.data.trim().startsWith('"v=DMARC1'));

                if (dmarcRecords.length > 0) {
                    populateDnsTable(document.getElementById('dmarcTableBody'), dmarcRecords);
                    document.getElementById('dmarcResults').style.display = 'block';
                } else {
                    displayError('error-message-dmarc', 'No DMARC record found for this domain.');
                }
            } catch (error) {
                displayError('error-message-dmarc', 'An error occurred. Please check your connection or the domain name.', error);
            } finally {
                document.getElementById('dmarcLoadingSpinner').style.display = 'none';
            }
        }

        async function performSpfLookup(domain) {
            toggleLoadingState('spfLoadingSpinner', 'spfResults', 'error-message-spf', true);
            document.getElementById('spfTableBody').innerHTML = '';

            if (!domain) {
                displayError('error-message-spf', 'Please enter a domain name.');
                document.getElementById('spfLoadingSpinner').style.display = 'none';
                return;
            }

            try {
                const data = await fetchDnsRecords(domain, 'TXT');
                const spfRecords = (data.Answer || []).filter(record => record.data.trim().startsWith('"v=spf1'));

                if (spfRecords.length > 0) {
                    populateDnsTable(document.getElementById('spfTableBody'), spfRecords);
                    document.getElementById('spfResults').style.display = 'block';
                } else {
                    displayError('error-message-spf', 'No SPF record found for this domain.');
                }
            } catch (error) {
                displayError('error-message-spf', 'An error occurred. Please check your connection or the domain name.', error);
            } finally {
                document.getElementById('spfLoadingSpinner').style.display = 'none';
            }
        }

        async function performDkimLookup(domain) {
            toggleLoadingState('dkimLoadingSpinner', 'dkimResults', 'error-message-dkim', true);
            document.getElementById('dkimTableBody').innerHTML = '';

            if (!domain) {
                displayError('error-message-dkim', 'Please enter a domain name.');
                document.getElementById('dkimLoadingSpinner').style.display = 'none';
                return;
            }

            const commonSelectors = ['google', 's1', 's2', 'k1', 'default', 'mail', 'selector1', '2020'];
            let dkimFound = false;

            for (const selector of commonSelectors) {
                const dkimDomain = `${selector}._domainkey.${domain}`;
                try {
                    const data = await fetchDnsRecords(dkimDomain, 'TXT');
                    const dkimRecords = (data.Answer || []).filter(record => record.data.trim().startsWith('"v=DKIM1;'));
                    if (dkimRecords.length > 0) {
                        populateDnsTable(document.getElementById('dkimTableBody'), dkimRecords);
                        dkimFound = true;
                        break;
                    }
                } catch (error) {
                    console.error(`DKIM fetch error for ${dkimDomain}:`, error);
                }
            }
            
            if (dkimFound) {
                document.getElementById('dkimResults').style.display = 'block';
            } else {
                displayError('error-message-dkim', `No common DKIM record found for "${domain}".`);
            }
            document.getElementById('dkimLoadingSpinner').style.display = 'none';
        }

        async function performCnameLookup(domain) {
            toggleLoadingState('cnameLoadingSpinner', 'cnameResults', 'error-message-cname', true);
            document.getElementById('cnameTableBody').innerHTML = '';

            if (!domain) {
                displayError('error-message-cname', 'Please enter a domain or subdomain name.');
                document.getElementById('cnameLoadingSpinner').style.display = 'none';
                return;
            }

            try {
                const data = await fetchDnsRecords(domain, 'CNAME');
                if (data.Answer && data.Answer.length > 0) {
                    populateDnsTable(document.getElementById('cnameTableBody'), data.Answer);
                    document.getElementById('cnameResults').style.display = 'block';
                } else {
                    displayError('error-message-cname', 'No CNAME record found for this domain.');
                }
            } catch (error) {
                displayError('error-message-cname', 'An error occurred. Please check your connection or the domain name.', error);
            } finally {
                document.getElementById('cnameLoadingSpinner').style.display = 'none';
            }
        }

        async function performAaaaLookup(domain) {
            toggleLoadingState('aaaaLoadingSpinner', 'aaaaResults', 'error-message-aaaa', true);
            document.getElementById('aaaaTableBody').innerHTML = '';

            if (!domain) {
                displayError('error-message-aaaa', 'Please enter a domain name.');
                document.getElementById('aaaaLoadingSpinner').style.display = 'none';
                return;
            }

            try {
                const data = await fetchDnsRecords(domain, 'AAAA');
                if (data.Answer && data.Answer.length > 0) {
                    populateDnsTable(document.getElementById('aaaaTableBody'), data.Answer);
                    document.getElementById('aaaaResults').style.display = 'block';
                } else {
                    displayError('error-message-aaaa', 'No AAAA record found for this domain.');
                }
            } catch (error) {
                displayError('error-message-aaaa', 'An error occurred. Please check your connection or the domain name.', error);
            } finally {
                document.getElementById('aaaaLoadingSpinner').style.display = 'none';
            }
        }

        async function performIpLeakTest() {
            toggleLoadingState('ipLeakTestLoadingSpinner', 'ipLeakTestResults', 'error-message-ip-leak', true);
            
            try {
                const ipResponse = await fetch('https://ipinfo.io/json');
                if (!ipResponse.ok) throw new Error(`HTTP error! status: ${ipResponse.status}`);
                const ipData = await ipResponse.json();

                if (ipData.error) {
                    displayError('error-message-ip-leak', ipData.error.message || 'Error performing IP leak test.', ipData.error);
                    return;
                }

                document.getElementById('leak-ip-address').textContent = ipData.ip || 'N/A';
                document.getElementById('leak-country').textContent = ipData.country || 'N/A';
                document.getElementById('leak-city').textContent = ipData.city || 'N/A';
                document.getElementById('leak-isp').textContent = ipData.org || 'N/A';

                // Reverse DNS lookup for hostname
                let hostname = 'N/A';
                if (ipData.ip) {
                    let reversedIp = ipData.ip.split('.').reverse().join('.');
                    const dnsApiURL = `https://cloudflare-dns.com/dns-query?name=${reversedIp}.in-addr.arpa&type=PTR`;
                    try {
                        const dnsResponse = await fetch(dnsApiURL, { headers: { 'Accept': 'application/dns-json' }});
                        if (dnsResponse.ok) {
                            const dnsData = await dnsResponse.json();
                            if (dnsData.Answer && dnsData.Answer.length > 0) {
                                hostname = dnsData.Answer[0].data.replace(/\.$/, '');
                            }
                        }
                    } catch (dnsError) {
                        console.error('Reverse DNS lookup error:', dnsError);
                    }
                }
                document.getElementById('leak-hostname').textContent = hostname;
                document.getElementById('ipLeakTestResults').style.display = 'block';

            } catch (error) {
                displayError('error-message-ip-leak', 'An error occurred. Please check your connection.', error);
            } finally {
                document.getElementById('ipLeakTestLoadingSpinner').style.display = 'none';
            }
        }

        async function performDomainInfoLookup(domain) {
            toggleLoadingState('domainInfoLoadingSpinner', 'domainInfoResults', 'error-message-domain-info', true);
            document.getElementById('domainInfoTableBody').innerHTML = '';

            if (!domain) {
                displayError('error-message-domain-info', 'Please enter a domain name.');
                document.getElementById('domainInfoLoadingSpinner').style.display = 'none';
                return;
            }

            // Using the new 'who-dat.as93.net' API as an alternative
            const apiURL = `https://who-dat.as93.net/${domain}`;
            try {
                const response = await fetch(apiURL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                if (data.error) {
                    displayError('error-message-domain-info', data.error || 'Could not retrieve WHOIS information for this domain.');
                } else {
                    const infoToShow = {
                        "Domain Name": data.domain_name,
                        "Registrar": data.registrar,
                        "Created Date": data.creation_date,
                        "Updated Date": data.updated_date,
                        "Expiration Date": data.expiration_date,
                        "Name Servers": (data.name_servers || []).join(', '),
                        "Registrar URL": data.registrar_url
                    };
                    
                    if (data.registrant) {
                        infoToShow["Registrant Name"] = data.registrant.name;
                        infoToShow["Registrant Organization"] = data.registrant.organization;
                        infoToShow["Registrant Email"] = data.registrant.email;
                        infoToShow["Registrant Country"] = data.registrant.country;
                    }

                    for (const key in infoToShow) {
                        if (infoToShow[key]) {
                            const row = document.getElementById('domainInfoTableBody').insertRow();
                            row.insertCell(0).textContent = key;
                            row.insertCell(1).textContent = infoToShow[key];
                        }
                    }
                    document.getElementById('domainInfoResults').style.display = 'block';
                }
            } catch (error) {
                displayError('error-message-domain-info', 'An error occurred. Please check your connection or the domain name.', error);
            } finally {
                document.getElementById('domainInfoLoadingSpinner').style.display = 'none';
            }
        }

        async function performIpSecurityCheck(ipAddress) {
            toggleLoadingState('ipSecurityLoadingSpinner', 'ipSecurityResults', 'error-message-security-ip', true);
            const securityStatusMessage = document.getElementById('securityStatusMessage');
            securityStatusMessage.className = 'security-status';

            if (!ipAddress) {
                displayError('error-message-security-ip', 'Please enter an IP address.');
                document.getElementById('ipSecurityLoadingSpinner').style.display = 'none';
                return;
            }

            const apiURL = `https://ipinfo.io/${ipAddress}/json`;
            try {
                const response = await fetch(apiURL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();

                if (data.error) {
                    displayError('error-message-security-ip', data.error.message || 'Error checking IP security.', data.error);
                } else {
                    document.querySelector('#securityIpAddress span').textContent = data.ip || 'N/A';
                    document.getElementById('vpnStatus').textContent = data.vpn ? 'Yes' : 'No';
                    document.getElementById('proxyStatus').textContent = data.proxy ? 'Yes' : 'No';
                    document.getElementById('torStatus').textContent = data.tor ? 'Yes' : 'No';

                    if (data.vpn || data.proxy || data.tor) {
                        securityStatusMessage.textContent = 'This IP is associated with a VPN, Proxy, or TOR exit node.';
                        securityStatusMessage.classList.add('warning');
                    } else {
                        securityStatusMessage.textContent = 'This IP appears to be clean (not associated with known VPN/Proxy/TOR).';
                        securityStatusMessage.classList.add('safe');
                    }
                    document.getElementById('ipSecurityResults').style.display = 'block';
                }
            } catch (error) {
                displayError('error-message-security-ip', 'An error occurred. Please check your connection or the IP address.', error);
            } finally {
                document.getElementById('ipSecurityLoadingSpinner').style.display = 'none';
            }
        }

        async function performDomainSecurityCheck(domain) {
            toggleLoadingState('domainSecurityLoadingSpinner', 'domainSecurityResults', 'error-message-security-domain', true);
            const domainSecurityStatusMessage = document.getElementById('domainSecurityStatusMessage');
            const domainSecurityTableBody = document.getElementById('domainSecurityTableBody');
            domainSecurityStatusMessage.className = 'security-status';
            domainSecurityTableBody.innerHTML = '';

            if (!domain) {
                displayError('error-message-security-domain', 'Please enter a domain name.');
                document.getElementById('domainSecurityLoadingSpinner').style.display = 'none';
                return;
            }

            document.getElementById('checkedDomain').textContent = domain;
            const recordTypes = ['A', 'AAAA', 'MX', 'TXT', 'NS', 'CNAME'];
            const fetchPromises = recordTypes.map(type => fetchDnsRecords(domain, type).catch(() => ({ Answer: [] })));

            try {
                const allData = await Promise.all(fetchPromises);
                let hasAnyRecords = false;
                let suspiciousCount = 0;

                const checkStatus = (recordData, checkName, isWarning = false) => {
                    const status = (recordData && recordData.length > 0) ? 'Yes' : 'No';
                    if (status === 'No' && isWarning) {
                        suspiciousCount++;
                    }
                    const row = domainSecurityTableBody.insertRow();
                    row.insertCell(0).textContent = checkName;
                    const statusCell = row.insertCell(1);
                    statusCell.textContent = status;
                    statusCell.style.color = (status === 'No' && isWarning) ? '#e74c3c' : '#27ae60';
                };

                const aRecords = allData[0].Answer || [];
                const aaaaRecords = allData[1].Answer || [];
                if (aRecords.length > 0 || aaaaRecords.length > 0) {
                    checkStatus(aRecords.concat(aaaaRecords), 'A/AAAA Records Found', false);
                    hasAnyRecords = true;
                } else {
                    checkStatus([], 'A/AAAA Records Found', true);
                }

                const mxRecords = allData[2].Answer || [];
                checkStatus(mxRecords, 'MX Records Found', true);

                const txtRecords = allData[3].Answer || [];
                checkStatus(txtRecords, 'TXT Records Found', false);

                const nsRecords = allData[4].Answer || [];
                checkStatus(nsRecords, 'NS Records Found', true);
                if (nsRecords.length > 0) hasAnyRecords = true;

                const cnameRecords = allData[5].Answer || [];
                checkStatus(cnameRecords, 'CNAME Records Found', false);
                
                if (hasAnyRecords && suspiciousCount === 0) {
                    domainSecurityStatusMessage.textContent = 'Domain appears to be legitimate and well-configured.';
                    domainSecurityStatusMessage.classList.add('safe');
                } else if (hasAnyRecords && suspiciousCount > 0) {
                    domainSecurityStatusMessage.textContent = 'Domain has some records but shows potential configuration issues.';
                    domainSecurityStatusMessage.classList.add('warning');
                } else {
                    domainSecurityStatusMessage.textContent = 'Domain does not appear to resolve or has no common records. Could be inactive or suspicious.';
                    domainSecurityStatusMessage.classList.add('warning');
                }
                
                document.getElementById('domainSecurityResults').style.display = 'block';

            } catch (error) {
                displayError('error-message-security-domain', 'An error occurred. Please check your connection or the domain name.', error);
            } finally {
                document.getElementById('domainSecurityLoadingSpinner').style.display = 'none';
            }
        }


        // --- Navigation Logic ---
        const sections = {
            ipLookupSection: 'showIpLookup',
            dnsLookupSection: 'showDnsLookup',
            mxLookupSection: 'showMxLookup',
            dmarcLookupSection: 'showDmarcLookup',
            spfLookupSection: 'showSpfLookup',
            dkimLookupSection: 'showDkimLookup',
            cnameLookupSection: 'showCnameLookup',
            aaaaLookupSection: 'showAaaaLookup',
            ipLeakTestSection: 'showIpLeakTest',
            domainInfoSection: 'showDomainInfo',
            securityChecksSection: 'showSecurityChecks',
            knowYourLookupSection: 'showKnowYourLookup'
        };

        function showSection(sectionId) {
            for (const id in sections) {
                document.getElementById(id).style.display = 'none';
                document.getElementById(sections[id]).classList.remove('active');
            }
            document.getElementById(sectionId).style.display = 'block';
            document.getElementById(sections[sectionId]).classList.add('active');
        }

        // Initial display: show IP Lookup section by default
        showSection('ipLookupSection');

        // Event listeners for navigation buttons
        for (const id in sections) {
            document.getElementById(sections[id]).addEventListener('click', () => showSection(id));
        }

        // --- Event listeners for forms/buttons ---
        document.getElementById('ipForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const ipAddress = document.getElementById('ipInput').value.trim();
            performIpLookup(ipAddress);
        });

        document.getElementById('findMyIpLink').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('ipInput').value = '';
            performIpLookup('');
        });
        
        document.getElementById('dnsForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const domain = document.getElementById('dnsInput').value.trim();
            performDnsLookup(domain);
        });

        document.getElementById('mxForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const domain = document.getElementById('mxDomainInput').value.trim();
            performMxLookup(domain);
        });

        document.getElementById('dmarcForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const domain = document.getElementById('dmarcDomainInput').value.trim();
            performDmarcLookup(domain);
        });

        document.getElementById('spfForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const domain = document.getElementById('spfDomainInput').value.trim();
            performSpfLookup(domain);
        });

        document.getElementById('dkimForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const domain = document.getElementById('dkimDomainInput').value.trim();
            performDkimLookup(domain);
        });

        document.getElementById('cnameForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const domain = document.getElementById('cnameDomainInput').value.trim();
            performCnameLookup(domain);
        });

        document.getElementById('aaaaForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const domain = document.getElementById('aaaaDomainInput').value.trim();
            performAaaaLookup(domain);
        });

        document.getElementById('performIpLeakTestButton').addEventListener('click', (e) => {
            e.preventDefault();
            performIpLeakTest();
        });

        document.getElementById('domainInfoForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const domain = document.getElementById('domainInfoInput').value.trim();
            performDomainInfoLookup(domain);
        });

        document.getElementById('ipSecurityForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const ipAddress = document.getElementById('securityIpInput').value.trim();
            performIpSecurityCheck(ipAddress);
        });

        document.getElementById('domainSecurityForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const domain = document.getElementById('securityDomainInput').value.trim();
            performDomainSecurityCheck(domain);
        });
    </script>
</body>
</html>